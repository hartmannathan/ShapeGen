/*
  Copyright (C) 2019 Jerry R. VanAken

  This software is provided 'as-is', without any express or implied
  warranty.  In no event will the authors be held liable for any damages
  arising from the use of this software.

  Permission is granted to anyone to use this software for any purpose,
  including commercial applications, and to alter it and redistribute it
  freely, subject to the following restrictions:

  1. The origin of this software must not be misrepresented; you must not
     claim that you wrote the original software. If you use this software
     in a product, an acknowledgment in the product documentation would be
     appreciated but is not required.

  2. Altered source versions must be plainly marked as such, and must not be
     misrepresented as being the original software.

  3. This notice may not be removed or altered from any source distribution.
*/
//----------------------------------------------------------------------
//
// A simple text-drawing application. The font is stroke-based and is
// constructed using a combination of straight line segments and
// elliptic arcs.
//
//----------------------------------------------------------------------

#include <string.h>
#include <math.h>
#include <assert.h>
#include "demo.h"

struct GLYPH
{
    int charcode;  // character code for this glyph
    int xyindex;   // glyph's starting index into xytbl array
    int xylen;     // number of xytbl elements for this glyph
    SGPoint *xy;   // transformed glyph x-y coords in 16.16 fixed point
    char *displist;  // string containing glyph display list
};

// Display list verbs
#define MOVE                "\x1"
#define LINE                "\x2"
#define CLOSEFIGURE         "\x3"
#define ENDFIGURE           "\x4"
#define POLYLINE            "\x5"
#define ELLIPSE             "\x6"
#define ELLIPTICARC         "\x7"
#define POLYELLIPTICSPLINE  "\x8"
#define DRAWADOT            "\x9"

const int _MOVE_               = 0x1;
const int _LINE_               = 0x2;
const int _CLOSEFIGURE_        = 0x3;
const int _ENDFIGURE_          = 0x4;
const int _POLYLINE_           = 0x5;
const int _ELLIPSE_            = 0x6;
const int _ELLIPTICARC_        = 0x7;
const int _POLYELLIPTICSPLINE_ = 0x8;
const int _DRAWADOT_           = 0x9;

// Right- and left-side bearings for this font
const float leftbearing = 8.0;
const float rightbearing = 8.0;

//----------------------------------------------------------------------
//
// The xytbl array contains the points that define the shapes of all
// the glyphs. The first two entries for each glyph specify the
// bounding box for the glyph.
//
// Font metrics (specified in pixels):
//   - Glyph-relative x-y origin is located at intersection of baseline
//     with left edge of bounding box       
//   - Ascender line is at y = 66            
//   - Descender line is at y = -26          
//   - Caps height is 60
//   - x height is 42   
//   - M width is 64
//
//----------------------------------------------------------------------

const XY xytbl[] = {

    // glyph ' ' (blank space)
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 28.000000, 60.000000 },  // 1 bounding box max

    // glyph '!'
    {  0.000000,  0.000000 },  // 0 bounding box min
    {  4.000000, 66.000000 },  // 1 bounding box max
    {  2.000000,  0.000000 },  // 2
    {  2.000000, 66.000000 },  // 3
    {  2.000000, 19.000000 },  // 4

    // glyph '\"'
    {  0.000000, 54.000000 },  //  0 bounding box min
    { 20.000000, 66.000000 },  //  1 bounding box max
    {  4.000000, 66.000000 },  //  2
    {  4.000000, 54.000000 },  //  3
    { 16.000000, 66.000000 },  //  4
    { 16.000000, 54.000000 },  //  5

    // glyph '#'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 49.000000, 60.000000 },  // 1 bounding box max
    { 17.500000, 60.000000 },  // 2
    {  9.500000,  0.000000 },  // 3
    { 39.500000, 60.000000 },  // 4
    { 31.500000,  0.000000 },  // 5
    {  3.500000, 40.000000 },  // 6
    { 49.000000, 40.000000 },  // 7
    {  0.000000, 19.000000 },  // 8
    { 45.500000, 19.000000 },  // 9

    // glyph '$'
    {  0.000000, -7.000000 },  //  0 bounding box min
    { 32.000000, 60.000000 },  //  1 bounding box max
    { 29.325375, 52.404259 },  //  2
    { 24.453732, 59.957447 },  //  3
    { 16.047760, 59.957447 },  //  4
    {  2.674627, 59.957447 },  //  5
    {  2.674627, 47.368797 },  //  6
    {  2.674627, 34.276596 },  //  7
    { 16.238806, 32.463829 },  //  8
    { 32.000000, 30.248226 },  //  9
    { 32.000000, 16.451063 },  // 10
    { 32.000000,  1.042553 },  // 11
    { 16.238806,  1.042553 },  // 12
    {  4.776119,  1.042553 },  // 13
    {  0.000000, 12.120567 },  // 14
    { 16.000000, -7.000000 },  // 15
    { 16.000000, 66.000000 },  // 16

    // glyph '%'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 60.000000, 60.000000 },  // 1 bounding box max
    {  0.000000,  0.000000 },  // 2
    { 60.000000, 60.000000 },  // 3
    { 10.000000, 45.000000 },  // 4
    { 10.000000, 60.000000 },  // 5
    { 20.000000, 45.000000 },  // 6
    { 50.000000, 15.000000 },  // 7
    { 50.000000, 30.000000 },  // 8
    { 60.000000, 15.000000 },  // 9

    // glyph '&'
    {  0.000000, -1.500000 },  //  0 bounding box min
    { 48.000000, 62.000000 },  //  1 bounding box max
    { 47.105591, 29.542025 },  //  2
    { 47.105591, -1.500000 },  //  3
    { 21.366459, -1.500000 },  //  4
    {  3.975155, -1.500000 },  //  5
    {  3.975155, 16.471699 },  //  6
    {  3.975155, 23.333618 },  //  7
    {  8.447205, 27.908234 },  //  8
    { 11.925466, 32.482849 },  //  9
    { 19.577641, 36.186104 },  // 10
    { 24.248447, 38.909088 },  // 11
    { 29.316771, 44.790737 },  // 12
    { 43.428574, 62.000000 },  // 13
    { 21.366459, 62.000000 },  // 14
    {  0.000000, 62.000000 },  // 15
    { 18.086956, 36.295029 },  // 16
    { 43.229813,  0.000000 },  // 17
    { 48.000000,  0.000000 },  // 18

    // glyph '\''
    {  0.000000, 54.000000 },  // 0 bounding box min
    {  8.000000, 66.000000 },  // 1 bounding box max
    {  4.000000, 66.000000 },  // 2
    {  4.000000, 54.000000 },  // 3

    // glyph '('
    {  0.000000,-26.000000 },  // 0 bounding box min
    { 14.000000, 66.000000 },  // 1 bounding box max
    { 14.000000, 66.000000 },  // 2
    {  0.000000, 50.000000 },  // 3
    {  0.000000, 20.000000 },  // 4
    {  0.000000,-10.000000 },  // 5
    { 14.000000,-26.000000 },  // 6

    // glyph ')'
    {  0.000000,-26.000000 },  // 0 bounding box min
    { 14.000000, 66.000000 },  // 1 bounding box max
    {  0.000000, 66.000000 },  // 2
    { 14.000000, 50.000000 },  // 3
    { 14.000000, 20.000000 },  // 4
    { 14.000000,-10.000000 },  // 5
    {  0.000000,-26.000000 },  // 6

    // glyph '*'
    {  0.000000, 26.000000 },  // 0 bounding box min
    { 34.000000, 66.000000 },  // 1 bounding box max
    { 17.000000, 66.000000 },  // 2
    { 17.000000, 26.000000 },  // 3
    { 34.000000, 56.000000 },  // 4
    {  0.000000, 36.000000 },  // 5
    { 34.000000, 36.000000 },  // 6
    {  0.000000, 56.000000 },  // 7

    // glyph '+'
    {  0.000000,  4.000000 },  // 0 bounding box min
    { 42.000000, 46.000000 },  // 1 bounding box max
    { 21.000000, 46.000000 },  // 2
    { 21.000000,  4.000000 },  // 3
    {  0.000000, 25.000000 },  // 4
    { 42.000000, 25.000000 },  // 5

    // glyph ','
    {  0.000000, -9.000000 },  // 0 bounding box min
    {  5.000000,  0.000000 },  // 1 bounding box max
    {  2.500000,  0.000000 },  // 2
    {  5.000000, -1.000000 },  // 3
    {  5.000000, -5.000000 },  // 4
    {  0.000000, -9.000000 },  // 5

    // glyph '-'
    {  0.000000, 21.000000 },  // 0 bounding box min
    { 32.000000, 23.000000 },  // 1 bounding box max
    {  0.000000, 22.000000 },  // 4
    { 32.000000, 22.000000 },  // 5

    // glyph '.' 
    {  0.000000,  0.000000 },  // 0 bounding box min
    {  4.000000,  0.000000 },  // 1 bounding box max
    {  2.000000,  0.000000 },  // 2

    // glyph '/'
    {  0.000000,-26.000000 },  // 0 bounding box min
    { 36.000000, 66.000000 },  // 1 bounding box max
    {  0.000000,-26.000000 },  // 2
    { 36.000000, 66.000000 },  // 3

    // glyph '0' (numeral zero)
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 42.000000, 62.000000 },  // 1 bounding box max
    { 21.000000, 31.000000 },  // 2
    { 21.000000, 62.000000 },  // 3
    { 42.000000, 31.000000 },  // 4

    // glyph '1'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 16.000000, 60.000000 },  // 1 bounding box max
    { 12.000000,  0.000000 },  // 2
    { 12.000000, 60.000000 },  // 3
    {  4.000000, 44.000000 },  // 4

    // glyph '2'
    {  0.000000,  0.000000 },  //  0 bounding box min
    { 38.000000, 62.000000 },  //  1 bounding box max
    {  2.000000, 52.000000 },  //  2
    {  8.000000, 62.000000 },  //  3
    { 20.000000, 62.000000 },  //  4
    { 36.000000, 62.000000 },  //  5
    { 36.000000, 44.000000 },  //  6
    { 36.000000, 30.000000 },  //  7
    { 18.000000, 20.000000 },  //  8
    {  0.000000,  8.000000 },  //  9
    {  0.000000,  0.000000 },  // 10
    { 38.000000,  0.000000 },  // 11

    // glyph '3'
    {  0.000000, -1.500000 },  //  0 bounding box min
    { 38.000000, 62.000000 },  //  1 bounding box max
    {  3.000000, 55.000000 },  //  2
    {  8.000000, 62.000000 },  //  3
    { 20.000000, 62.000000 },  //  4
    { 36.000000, 62.000000 },  //  5
    { 36.000000, 47.500000 },  //  6
    { 36.000000, 33.000000 },  //  7
    { 21.000000, 33.000000 },  //  8
    {  8.000000, 33.000000 },  //  9
    { 21.000000, 33.000000 },  // 10
    { 38.000000, 33.000000 },  // 11
    { 38.000000, 17.000000 },  // 12
    { 38.000000, -1.500000 },  // 13
    { 20.000000, -1.500000 },  // 14
    {  8.000000, -1.500000 },  // 15
    {  0.000000,  7.000000 },  // 16

    // glyph '4'
    {  0.000000,  0.000000 },  //  0 bounding box min
    { 40.000000, 60.000000 },  //  1 bounding box max
    { 32.000000,  0.000000 },  //  2
    { 32.000000, 60.000000 },  //  3
    {  0.000000, 17.000000 },  //  4
    { 40.000000, 17.000000 },  //  5

    // glyph '5'
    {  0.000000, -1.500000 },  //  0 bounding box min
    { 38.000000, 60.000000 },  //  1 bounding box max
    { 34.000000, 60.000000 },  //  2
    {  3.000000, 60.000000 },  //  3
    {  3.000000, 32.000000 },  //  4
    { 11.000000, 35.000000 },  //  5
    { 21.000000, 35.000000 },  //  6
    { 38.000000, 35.000000 },  //  7
    { 38.000000, 17.000000 },  //  8
    { 38.000000, -1.500000 },  //  9
    { 20.000000, -1.500000 },  // 10
    {  8.000000, -1.500000 },  // 11
    {  0.000000,  7.000000 },  // 12

    // glyph '6'
    {  0.000000, -1.500000 },  //  0 bounding box min
    { 38.500000, 62.000000 },  //  1 bounding box max
    { 35.500000, 56.500000 },  //  2
    { 31.500000, 62.000000 },  //  3
    { 20.500000, 62.000000 },  //  4
    {  7.500000, 62.000000 },  //  5
    {  2.500000, 47.500000 },  //  6
    { -3.500000, 29.500000 },  //  7
    {  2.500000, 11.500000 },  //  8
    {  7.500000, -1.500000 },  //  9
    { 20.500000, -1.500000 },  // 10
    { 38.500000, -1.500000 },  // 11
    { 38.500000, 16.500000 },  // 12
    { 38.500000, 39.000000 },  // 13
    { 18.500000, 36.500000 },  // 14
    { -5.000000, 33.500000 },  // 15
    {  2.500000, 11.500000 },  // 16

    // glyph '7'
    {  0.000000,  0.000000 },  //  0 bounding box min
    { 44.000000, 60.000000 },  //  1 bounding box max
    {  0.000000, 60.000000 },  //  2
    { 44.000000, 60.000000 },  //  3
    { 22.000000, 50.000000 },  //  4
    { 14.000000,  0.000000 },  //  5

    // glyph '8'
    {  0.000000, -1.500000 },  //  0 bounding box min
    { 38.000000, 62.000000 },  //  1 bounding box max
    { 19.000000, 32.400000 },  //  2
    { 35.000000, 34.300000 },  //  3
    { 35.000000, 48.500000 },  //  4
    { 35.000000, 62.000000 },  //  5
    { 19.000000, 62.000000 },  //  6
    {  3.000000, 62.000000 },  //  7
    {  3.000000, 48.500000 },  //  8
    {  3.000000, 34.300000 },  //  9
    { 19.000000, 32.400000 },  // 10
    { 38.000000, 30.000000 },  // 11
    { 38.000000, 15.000000 },  // 12
    { 38.000000, -1.500000 },  // 13
    { 19.000000, -1.500000 },  // 14
    {  0.000000, -1.500000 },  // 15
    {  0.000000, 15.000000 },  // 16
    {  0.000000, 30.000000 },  // 17
    { 19.000000, 32.400000 },  // 18

    // glyph '9'
    {  0.000000, -1.500000 },  //  0 bounding box min
    { 38.500000, 62.000000 },  //  1 bounding box max
    {  3.000000,  4.000000 },  //  2
    {  7.000000, -1.500000 },  //  3
    { 18.000000, -1.500000 },  //  4
    { 31.000000, -1.500000 },  //  5
    { 36.000000, 13.000000 },  //  6
    { 42.000000, 31.000000 },  //  7
    { 36.000000, 49.000000 },  //  8
    { 31.000000, 62.000000 },  //  9
    { 18.000000, 62.000000 },  // 10
    {  0.000000, 62.000000 },  // 11
    {  0.000000, 44.000000 },  // 12
    {  0.000000, 21.500000 },  // 13
    { 20.000000, 24.000000 },  // 14
    { 43.500000, 27.000000 },  // 15
    { 36.000000, 49.000000 },  // 16

    // glyph ':'
    {  0.000000,  0.000000 },  // 0 bounding box min
    {  4.000000, 42.000000 },  // 1 bounding box max
    {  2.000000, 42.000000 },  // 2
    {  2.000000,  0.000000 },  // 3

    // glyph ';'
    {  0.000000, -9.000000 },  // 0 bounding box min
    {  5.000000,  0.000000 },  // 1 bounding box max
    {  2.500000,  0.000000 },  // 2
    {  5.000000, -1.000000 },  // 3
    {  5.000000, -5.000000 },  // 4
    {  0.000000, -9.000000 },  // 5
    {  2.500000, 42.000000 },  // 6

    // glyph '<'
    {  0.000000, 10.000000 },  //  0 bounding box min
    { 38.000000, 46.000000 },  //  1 bounding box max
    { 38.000000, 46.000000 },  //  2
    {  0.000000, 28.000000 },  //  3
    { 38.000000, 10.000000 },  //  4

    // glyph '='
    {  0.000000, 18.000000 },  //  0 bounding box min
    { 35.000000, 38.000000 },  //  1 bounding box max
    {  0.000000, 38.000000 },  //  2
    { 35.000000, 38.000000 },  //  3
    {  0.000000, 18.000000 },  //  4
    { 35.000000, 18.000000 },  //  5

    // glyph '>'
    {  0.000000, 10.000000 },  //  0 bounding box min
    { 38.000000, 46.000000 },  //  1 bounding box max
    {  0.000000, 46.000000 },  //  2
    { 38.000000, 28.000000 },  //  3
    {  0.000000, 10.000000 },  //  4

    // glyph '?'
    {  0.000000,  0.000000 },  //  0 bounding box min
    { 35.000000, 66.000000 },  //  1 bounding box max
    {  0.000000, 47.024998 },  //  2
    {  0.000000, 66.000000 },  //  3
    { 18.260870, 66.000000 },  //  4
    { 35.000000, 66.000000 },  //  5
    { 35.000000, 50.531250 },  //  6
    { 35.000000, 44.962498 },  //  7
    { 32.311596, 40.940624 },  //  8
    { 29.623188, 36.918751 },  //  9
    { 25.565218, 33.979687 },  // 10
    { 21.507248, 31.040625 },  // 11
    { 19.123188, 26.245314 },  // 12
    { 16.739130, 21.449999 },  // 13
    { 17.246376, 14.437500 },  // 14
    { 17.246376,  0.000000 },  // 15

    // glyph '@'
    {  0.000000, -8.000000 },  //  0 bounding box min
    { 68.000000, 60.000000 },  //  1 bounding box max
    { 32.286472, 26.000000 },  //  2
    { 37.517239, 42.564102 },  //  3
    { 45.092838, 22.338461 },  //  4
    { 47.076923, 42.041027 },  //  5
    { 42.387268, 10.133332 },  //  6
    { 55.013260,  7.343590 },  //  7
    { 68.000000,  4.205128 },  //  8
    { 68.000000, 28.615385 },  //  9
    { 68.000000, 60.000000 },  // 10
    { 34.811668, 60.000000 },  // 11
    {  0.000000, 60.000000 },  // 12
    {  0.000000, 23.384615 },  // 13
    {  0.000000, -8.000000 },  // 14
    { 29.761272, -8.000000 },  // 15
    { 39.681698, -8.000000 },  // 16
    { 45.273209, -5.384615 },  // 17

    // glyph 'A'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 50.000000, 60.000000 },  // 1 bounding box max
    {  0.000000,  0.000000 },  // 2
    { 25.000000, 60.000000 },  // 3
    { 50.000000,  0.000000 },  // 4
    {  9.166667, 22.000000 },  // 5
    { 40.833333, 22.000000 },  // 6

    // glyph 'B'
    {  0.000000,  0.000000 },  //  0 bounding box min
    { 37.000000, 60.000000 },  //  1 bounding box max
    {  0.000000, 60.000000 },  //  2
    { 20.500000, 60.000000 },  //  3
    { 34.000000, 60.000000 },  //  4
    { 34.000000, 46.500000 },  //  5
    { 34.000000, 33.000000 },  //  6
    { 20.500000, 33.000000 },  //  7
    {  0.000000, 33.000000 },  //  8
    { 20.500000, 33.000000 },  //  9
    { 37.000000, 33.000000 },  // 10
    { 37.000000, 16.500000 },  // 11
    { 37.000000,  0.000000 },  // 12
    { 20.500000,  0.000000 },  // 13
    {  0.000000,  0.000000 },  // 14

    // glyph 'C'
    {  0.000000, -1.000000 },  // 0 bounding box min
    { 47.800000, 61.000000 },  // 1 bounding box max
    { 28.000000, 30.000000 },  // 2
    { 28.000000, -1.000000 },  // 3
    {  0.000000, 30.000000 },  // 4

    // glyph 'D'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 42.000000, 60.000000 },  // 1 bounding box max
    {  0.000000, 60.000000 },  // 2
    { 16.000000, 60.000000 },  // 3
    { 42.000000, 60.000000 },  // 4
    { 42.000000, 30.000000 },  // 5
    { 42.000000,  0.000000 },  // 6
    { 16.000000,  0.000000 },  // 7
    {  0.000000,  0.000000 },  // 8

    // glyph 'E'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 34.000000, 60.000000 },  // 1 bounding box max
    { 34.000000,  0.000000 },  // 2
    {  0.000000,  0.000000 },  // 3
    {  0.000000, 60.000000 },  // 4
    { 34.000000, 60.000000 },  // 5
    {  0.000000, 33.000000 },  // 6
    { 29.000000, 33.000000 },  // 7

    // glyph 'F'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 34.000000, 60.000000 },  // 1 bounding box max
    {  0.000000,  0.000000 },  // 2
    {  0.000000, 60.000000 },  // 3
    { 34.000000, 60.000000 },  // 4
    {  0.000000, 33.000000 },  // 5
    { 29.000000, 33.000000 },  // 6

    // glyph 'G'
    {  0.000000, -1.000000 },  // 0 bounding box min
    { 47.800000, 61.000000 },  // 1 bounding box max
    { 28.000000, 30.000000 },  // 2
    { 28.000000, -1.000000 },  // 3
    {  0.000000, 30.000000 },  // 4
    { 34.000000, 24.000000 },  // 5
    { 47.800000, 24.000000 },  // 6
    { 47.800000,  0.000000 },  // 7

    // glyph 'H'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 40.000000, 60.000000 },  // 1 bounding box max
    {  0.000000,  0.000000 },  // 2
    {  0.000000, 60.000000 },  // 3
    { 40.000000,  0.000000 },  // 4
    { 40.000000, 60.000000 },  // 5
    {  0.000000, 32.000000 },  // 6
    { 40.000000, 32.000000 },  // 7

    // glyph 'I'
    {  0.000000,  0.000000 },  // 0 bounding box min
    {  4.000000, 60.000000 },  // 1 bounding box max
    {  2.000000,  0.000000 },  // 2
    {  2.000000, 60.000000 },  // 3

    // glyph 'J'
    {  0.000000, -1.500000 },  // 0 bounding box min
    { 34.000000, 60.000000 },  // 1 bounding box max
    {  0.000000, 11.930233 },  // 2
    {  4.470589,  1.186047 },  // 3
    { 16.764706, -1.500000 },  // 4
    { 38.000000, -6.000000 },  // 5
    { 38.000000, 15.000000 },  // 6
    { 38.000000, 60.000000 },  // 7

    // glyph 'K'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 38.000000, 60.000000 },  // 1 bounding box max
    { 38.000000,  0.000000 },  // 2
    {  9.000000, 35.000000 },  // 3
    {  0.000000, 32.000000 },  // 4
    {  8.200000, 30.500000 },  // 5
    { 35.000000, 60.000000 },  // 6
    {  0.000000,  0.000000 },  // 7
    {  0.000000, 60.000000 },  // 8

    // glyph 'L'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 34.000000, 60.000000 },  // 1 bounding box max
    {  0.000000, 60.000000 },  // 2
    {  0.000000,  0.000000 },  // 3
    { 34.000000,  0.000000 },  // 4

    // glyph 'M'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 64.000000, 60.000000 },  // 1 bounding box max
    {  0.000000,  0.000000 },  // 2
    {  0.000000, 60.000000 },  // 3
    { 32.000000, 10.000000 },  // 4
    { 64.000000, 60.000000 },  // 5
    { 64.000000,  0.000000 },  // 6

    // glyph 'N'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 40.000000, 60.000000 },  // 1 bounding box max
    {  0.000000,  0.000000 },  // 2
    {  0.000000, 60.000000 },  // 3
    { 40.000000,  0.000000 },  // 4
    { 40.000000, 60.000000 },  // 5

    // glyph 'O'
    {  0.000000, -1.000000 },  // 0 bounding box min
    { 56.000000, 61.000000 },  // 1 bounding box max
    { 28.000000, 30.000000 },  // 2
    { 28.000000, -1.000000 },  // 3
    {  0.000000, 30.000000 },  // 4

    // glyph 'P'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 37.000000, 60.000000 },  // 1 bounding box max
    {  0.000000,  0.000000 },  // 2
    {  0.000000, 60.000000 },  // 3
    { 20.500000, 60.000000 },  // 4
    { 37.000000, 60.000000 },  // 5
    { 37.000000, 43.500000 },  // 6
    { 37.000000, 27.000000 },  // 7
    { 20.500000, 27.000000 },  // 8
    {  0.000000, 27.000000 },  // 9

    // glyph 'Q'
    {  0.000000, -3.000000 },  // 0 bounding box min
    { 56.000000, 61.000000 },  // 1 bounding box max
    { 28.000000, 30.000000 },  // 2
    { 28.000000, -1.000000 },  // 3
    {  0.000000, 30.000000 },  // 4
    { 35.000000, 14.000000 },  // 5
    { 35.000000, -3.000000 },  // 6
    { 54.000000, -3.000000 },  // 7

    // glyph 'R'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 38.000000, 60.000000 },  // 1 bounding box max
    {  0.000000,  0.000000 },  // 2
    {  0.000000, 60.000000 },  // 3
    { 15.000000, 60.000000 },  // 4
    { 33.000000, 60.000000 },  // 5
    { 33.000000, 45.000000 },  // 6
    { 33.000000, 30.000000 },  // 7
    { 15.000000, 30.000000 },  // 8
    {  0.000000, 30.000000 },  // 9
    { 10.000000, 30.000000 },  // 10
    { 20.000000, 30.000000 },  // 11
    { 38.000000,  0.000000 },  // 12

    // glyph 'S'
    {  0.000000, -1.000000 },  //  0 bounding box min
    { 38.000000, 61.000000 },  //  1 bounding box max
    { 34.823883, 53.051285 },  //  2
    { 29.038807, 61.000000 },  //  3
    { 19.056715, 61.000000 },  //  4
    {  3.176120, 61.000000 },  //  5
    {  3.176120, 47.752136 },  //  6
    {  3.176120, 33.974358 },  //  7
    { 19.283583, 32.066666 },  //  8
    { 38.000000, 29.735043 },  //  9
    { 38.000000, 15.215384 },  // 10
    { 38.000000, -1.000002 },  // 11
    { 19.283583, -1.000002 },  // 12
    {  5.671641, -1.000002 },  // 13
    {  0.000000, 10.658119 },  // 14

    // glyph 'T'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 42.000000, 60.000000 },  // 1 bounding box max
    {  0.000000, 60.000000 },  // 2
    { 42.000000, 60.000000 },  // 3
    { 21.000000, 60.000000 },  // 4
    { 21.000000,  0.000000 },  // 5

    // glyph 'U'
    {  0.000000, -1.500000 },  // 0 bounding box min
    { 40.000000, 60.000000 },  // 1 bounding box max
    {  0.000000, 60.000000 },  // 2
    {  0.000000, 20.000000 },  // 3
    {  0.000000, -1.500000 },  // 4
    { 20.000000, -1.500000 },  // 5
    { 40.000000, -1.500000 },  // 6
    { 40.000000, 20.000000 },  // 7
    { 40.000000, 60.000000 },  // 8

    // glyph 'V'
    {  0.000000, 0.0000000 },  // 0 bounding box min
    { 44.000000, 60.000000 },  // 1 bounding box max
    {  0.000000, 60.000000 },  // 2
    { 22.000000,  0.000000 },  // 3
    { 44.000000, 60.000000 },  // 4

    // glyph 'W'
    {  0.000000, 0.0000000 },  // 0 bounding box min
    { 76.000000, 60.000000 },  // 1 bounding box max
    {  0.000000, 60.000000 },  // 2
    { 19.000000,  0.000000 },  // 3
    { 38.000000, 60.000000 },  // 4
    { 57.000000,  0.000000 },  // 5
    { 76.000000, 60.000000 },  // 6

    // glyph 'X'
    {  0.000000, 0.0000000 },  // 0 bounding box min
    { 44.000000, 60.000000 },  // 1 bounding box max
    {  0.000000,  0.000000 },  // 2
    { 42.000000, 60.000000 },  // 3
    {  2.000000, 60.000000 },  // 4
    { 44.000000,  0.000000 },  // 5

    // glyph 'Y'
    {  0.000000, 0.0000000 },  // 0 bounding box min
    { 44.000000, 60.000000 },  // 1 bounding box max
    {  0.000000, 60.000000 },  // 2
    { 22.000000, 26.000000 },  // 3
    { 44.000000, 60.000000 },  // 4
    { 22.000000, 26.000000 },  // 5
    { 22.000000,  0.000000 },  // 6

    // glyph 'Z'
    {  0.000000, 0.0000000 },  // 0 bounding box min
    { 40.000000, 60.000000 },  // 1 bounding box max
    {  2.000000, 60.000000 },  // 2
    { 38.000000, 60.000000 },  // 3
    {  0.000000,  0.000000 },  // 4
    { 40.000000,  0.000000 },  // 5

    // glyph '['
    {  0.000000,-26.000000 },  // 0 bounding box min
    { 14.000000, 66.000000 },  // 1 bounding box max
    { 14.000000, 66.000000 },  // 2
    {  0.000000, 66.000000 },  // 3
    {  0.000000,-26.000000 },  // 4
    { 14.000000,-26.000000 },  // 5

    // glyph '\\'
    {  0.000000,-26.000000 },  // 0 bounding box min
    { 36.000000, 66.000000 },  // 1 bounding box max
    { 36.000000,-26.000000 },  // 2
    {  0.000000, 66.000000 },  // 3

    // glyph ']'
    {  0.000000,-26.000000 },  // 0 bounding box min
    { 14.000000, 66.000000 },  // 1 bounding box max
    {  0.000000, 66.000000 },  // 2
    { 14.000000, 66.000000 },  // 3
    { 14.000000,-26.000000 },  // 4
    {  0.000000,-26.000000 },  // 5

    // glyph '^'
    {  0.000000, 24.000000 },  // 0 bounding box min
    { 34.000000, 60.000000 },  // 1 bounding box max
    {  0.000000, 24.000000 },  // 2
    { 17.000000, 60.000000 },  // 3
    { 34.000000, 24.000000 },  // 4

    // glyph '_'
    {  0.000000,-26.000000 },  // 0 bounding box min
    { 42.000000,-26.000000 },  // 1 bounding box max
    {  0.000000,-26.000000 },  // 2
    { 42.000000,-26.000000 },  // 3

    // glyph '`'
    {  0.000000, 54.000000 },  // 0 bounding box min
    { 11.000000, 66.000000 },  // 1 bounding box max
    {  0.000000, 66.000000 },  // 2
    { 11.000000, 54.000000 },  // 3

    // glyph 'a'
    {  0.000000, -1.000000 },  // 0 bounding box min
    { 40.000000, 43.000000 },  // 1 bounding box max
    { 20.000000, 21.000000 },  // 2
    { 40.000000, 21.000000 },  // 4
    { 20.000000, -1.000000 },  // 3
    { 40.000000, 42.000000 },  // 5
    { 40.000000,  0.000000 },  // 6

    // glyph 'b'
    {  0.000000, -1.000000 },  // 0 bounding box min
    { 40.000000, 43.000000 },  // 1 bounding box max
    { 20.000000, 21.000000 },  // 2
    { 20.000000, -1.000000 },  // 3
    {  0.000000, 21.000000 },  // 4
    {  0.000000, 66.000000 },  // 5
    {  0.000000,  0.000000 },  // 6

    // glyph 'c'
    {  0.000000, -1.000000 },  // 0 bounding box min
    { 34.200000, 43.000000 },  // 1 bounding box max
    { 20.000000, 21.000000 },  // 2
    { 20.000000, -1.000000 },  // 3
    {  0.000000, 21.000000 },  // 4

    // glyph 'd'
    {  0.000000, -1.000000 },  // 0 bounding box min
    { 40.000000, 43.000000 },  // 1 bounding box max
    { 20.000000, 21.000000 },  // 2
    { 40.000000, 21.000000 },  // 4
    { 20.000000, -1.000000 },  // 3
    { 40.000000, 66.000000 },  // 5
    { 40.000000,  0.000000 },  // 6

    // glyph 'e'
    {  0.000000, -1.000000 },  //  0 bounding box min
    { 40.000000, 43.000000 },  //  1 bounding box max
    {  0.000000, 22.000000 },  //  2
    { 40.000000, 22.000000 },  //  3
    { 40.000000, 43.000000 },  //  4
    { 20.000000, 43.000000 },  //  5
    {  0.000000, 43.000000 },  //  6
    {  0.000000, 22.000000 },  //  7
    {  0.000000, -6.000000 },  //  8
    { 26.000000, -1.000000 },  //  9
    { 33.000000,  0.000000 },  // 10
    { 38.000000,  3.000000 },  // 11

    // glyph 'f'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 38.000000, 66.000000 },  // 1 bounding box max
    { 38.000000, 59.849895 },  // 2
    { 34.941177, 64.733616 },  // 3
    { 26.529411, 65.954544 },  // 4
    { 12.000000, 68.000000 },  // 5
    { 12.000000, 58.454544 },  // 6
    { 12.000000,  0.000000 },  // 7
    {  0.000000, 42.000000 },  // 8
    { 32.000000, 42.000000 },  // 9

    // glyph 'g'
    {  0.000000,-26.000000 },  //  0 bounding box min
    { 40.000000, 43.000000 },  //  1 bounding box max
    { 20.000000, 21.000000 },  // 2
    { 40.000000, 21.000000 },  // 4
    { 20.000000, -1.000000 },  // 3
    { 40.000000, 42.000000 },  //  5
    { 40.000000, -6.000000 },  //  6
    { 40.000000,-28.000000 },  //  7
    { 17.000000,-23.000000 },  //  8
    {  9.000000,-21.000000 },  //  9
    {  4.000000,-15.000000 },  // 10

    // glyph 'h'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 34.000000, 43.000000 },  // 1 bounding box max
    {  0.000000, 66.000000 },  // 2
    {  0.000000,  0.000000 },  // 3
    {  0.000000, 28.000000 },  // 4
    {  4.000000, 40.000000 },  // 5
    { 15.000000, 43.000000 },  // 6
    { 34.000000, 47.000000 },  // 7
    { 34.000000, 28.000000 },  // 8
    { 34.000000,  0.000000 },  // 9

    // glyph 'i'
    {  0.000000,  0.000000 },  // 0 bounding box min
    {  4.000000, 60.000000 },  // 1 bounding box max
    {  2.000000,  0.000000 },  // 2
    {  2.000000, 42.000000 },  // 3
    {  2.000000, 60.000000 },  // 4

    // glyph 'j'
    {  0.000000,-26.000000 },  // 0 bounding box min
    { 21.000000, 60.000000 },  // 1 bounding box max
    {  0.000000,-16.763214 },  // 2
    {  2.352941,-22.298096 },  // 3
    {  8.823529,-23.681818 },  // 4
    { 20.000000,-26.000000 },  // 5
    { 20.000000,-15.181818 },  // 6
    { 20.000000, 42.000000 },  // 7
    { 20.000000, 60.000000 },  // 8

    // glyph 'k'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 30.000000, 66.000000 },  // 1 bounding box max
    {  0.000000, 66.000000 },  // 2
    {  0.000000,  0.000000 },  // 3
    {  0.000000, 12.000000 },  // 4
    { 30.000000, 42.000000 },  // 5
    {  9.000000, 21.000000 },  // 6
    { 30.000000,  0.000000 },  // 7

    // glyph 'l'
    {  0.000000,  0.000000 },  // 0 bounding box min
    {  4.000000, 66.000000 },  // 1 bounding box max
    {  2.000000,  0.000000 },  // 2
    {  2.000000, 66.000000 },  // 3

    // glyph 'm'
    {  0.000000,  0.000000 },  //  0 bounding box min
    { 52.000000, 43.000000 },  //  1 bounding box max
    {  0.000000, 42.000000 },  //  2
    {  0.000000,  0.000000 },  //  3
    {  0.000000, 28.000000 },  //  4
    {  3.176471, 40.000000 },  //  5
    { 11.911765, 43.000000 },  //  6
    { 27.000000, 47.000000 },  //  7
    { 27.000000, 28.000000 },  //  8
    { 27.000000,  0.000000 },  //  9
    { 27.000000, 28.000000 },  // 10
    { 30.176471, 40.000000 },  // 11
    { 38.911765, 43.000000 },  // 12
    { 54.000000, 47.000000 },  // 13
    { 54.000000, 28.000000 },  // 14
    { 54.000000,  0.000000 },  // 15

    // glyph 'n'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 34.000000, 43.000000 },  // 1 bounding box max
    {  0.000000, 42.000000 },  // 2
    {  0.000000,  0.000000 },  // 3
    {  0.000000, 28.000000 },  // 4
    {  4.000000, 40.000000 },  // 5
    { 15.000000, 43.000000 },  // 6
    { 34.000000, 47.000000 },  // 7
    { 34.000000, 28.000000 },  // 8
    { 34.000000,  0.000000 },  // 9

    // glyph 'o'
    {  0.000000, -1.000000 },  // 0 bounding box min
    { 40.000000, 43.000000 },  // 1 bounding box max
    { 20.000000, 21.000000 },  // 2
    { 20.000000, -1.000000 },  // 3
    {  0.000000, 21.000000 },  // 4

    // glyph 'p'
    {  0.000000,-26.000000 },  // 0 bounding box min
    { 40.000000, 43.000000 },  // 1 bounding box max
    { 20.000000, 21.000000 },  // 2
    { 20.000000, -1.000000 },  // 3
    {  0.000000, 21.000000 },  // 4
    {  0.000000, 42.000000 },  // 5
    {  0.000000,-24.000000 },  // 6

    // glyph 'q'
    {  0.000000,-26.000000 },  // 0 bounding box min
    { 40.000000, 43.000000 },  // 1 bounding box max
    { 20.000000, 21.000000 },  // 2
    { 40.000000, 21.000000 },  // 4
    { 20.000000, -1.000000 },  // 3
    { 40.000000, 42.000000 },  // 5
    { 40.000000,-24.000000 },  // 6

    // glyph 'r'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 34.000000, 43.000000 },  // 1 bounding box max
    {  0.000000, 42.000000 },  // 2
    {  0.000000,  0.000000 },  // 3
    {  0.000000, 28.000000 },  // 4
    {  4.000000, 40.000000 },  // 5
    { 15.000000, 43.000000 },  // 6
    { 34.000000, 47.000000 },  // 7
    { 34.000000, 34.000000 },  // 8

    // glyph 's'
    {  0.000000, -1.500000 },  //  0 bounding box min
    { 34.000000, 43.000000 },  //  1 bounding box max
    { 29.325375, 37.358974 },  //  2
    { 24.453732, 43.000000 },  //  3
    { 16.047760, 43.000000 },  //  4
    {  2.674627, 43.000000 },  //  5
    {  2.674627, 33.598289 },  //  6
    {  2.674627, 23.820513 },  //  7
    { 16.238806, 22.466667 },  //  8
    { 32.000000, 20.811966 },  //  9
    { 32.000000, 10.507692 },  // 10
    { 32.000000, -1.000000 },  // 11
    { 16.238806, -1.000000 },  // 12
    {  4.776119, -1.000000 },  // 13
    {  0.000000,  7.273504 },  // 14

    // glyph 't'
    {  0.000000, -1.000000 },  //  0 bounding box min
    { 30.000000, 56.000000 },  //  1 bounding box max
    { 12.000000, 56.000000 },  //  2
    { 12.000000,  7.000000 },  //  3
    { 12.000000,  6.000000 },  //  4
    { 13.000000,  4.000000 },  //  5
    { 14.000000, -1.000000 },  //  6
    { 21.000000, -1.000000 },  //  7
    { 25.000000, -1.000000 },  //  8
    { 28.000000,  1.000000 },  //  9
    {  0.000000, 42.000000 },  // 10
    { 30.000000, 42.000000 },  // 11

    // glyph 'u'
    {  0.000000, -1.000000 },  //  0 bounding box min
    { 34.000000, 43.000000 },  //  1 bounding box max
    { 34.000000,  0.000000 },  // 2
    { 34.000000, 42.000000 },  // 3
    { 34.000000, 14.000000 },  // 4
    { 30.000000,  2.000000 },  // 5
    { 19.000000, -1.000000 },  // 6
    {  0.000000, -5.000000 },  // 7
    {  0.000000, 14.000000 },  // 8
    {  0.000000, 42.000000 },  // 9

    // glyph 'v'
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 38.000000, 42.000000 },  // 1 bounding box max
    {  0.000000, 42.000000 },  // 2
    { 19.000000,  0.000000 },  // 3
    { 38.000000, 42.000000 },  // 4

    // glyph 'w'
    {  0.000000, 0.0000000 },  // 0 bounding box min
    { 54.000000, 42.000000 },  // 1 bounding box max
    {  0.000000, 42.000000 },  // 2
    { 13.500000,  0.000000 },  // 3
    { 27.000000, 42.000000 },  // 4
    { 40.500000,  0.000000 },  // 5
    { 54.000000, 42.000000 },  // 6

    // glyph 'x'
    {  0.000000, 0.0000000 },  // 0 bounding box min
    { 32.000000, 42.000000 },  // 1 bounding box max
    {  1.000000, 42.000000 },  // 2
    { 32.000000,  0.000000 },  // 3
    { 31.000000, 42.000000 },  // 4
    {  0.000000,  0.000000 },  // 5

    // glyph 'y'
    {  0.000000,-26.000000 },  // 0 bounding box min
    { 38.000000, 42.000000 },  // 1 bounding box max
    {  0.000000, 42.000000 },  // 2
    { 19.000000,  0.000000 },  // 3
    { 38.000000, 42.000000 },  // 4
    {  7.147000,-26.000000 },  // 5

    // glyph 'z'
    {  0.000000, 0.0000000 },  // 0 bounding box min
    { 32.000000, 42.000000 },  // 1 bounding box max
    {  1.000000, 42.000000 },  // 2
    { 31.000000, 42.000000 },  // 3
    {  0.000000,  0.000000 },  // 4
    { 32.000000,  0.000000 },  // 5

    // glyph '{'
    {  0.000000,-26.000000 },  //  0 bounding box min
    { 14.000000, 66.000000 },  //  1 bounding box max
    { 14.000000, 66.000000 },  //  2
    { -2.000000, 59.000000 },  //  3
    {  7.000000, 43.000000 },  //  4
    { 16.000000, 27.000000 },  //  5
    {  0.000000, 20.000000 },  //  6
    { 16.000000, 13.000000 },  //  7
    {  7.000000, -3.000000 },  //  8
    { -2.000000,-19.000000 },  //  9
    { 14.000000,-26.000000 },  // 10

    // glyph '|'
    {  0.000000,-26.000000 },  // 0 bounding box min
    {  4.000000, 66.000000 },  // 1 bounding box max
    {  2.000000,-26.000000 },  // 2
    {  2.000000, 66.000000 },  // 3

    // glyph '}'
    {  0.000000,-26.000000 },  //  0 bounding box min
    { 14.000000, 66.000000 },  //  1 bounding box max
    {  0.000000, 66.000000 },  //  2
    { 16.000000, 59.000000 },  //  3
    {  7.000000, 43.000000 },  //  4
    { -2.000000, 27.000000 },  //  5
    { 14.000000, 20.000000 },  //  6
    { -2.000000, 13.000000 },  //  7
    {  7.000000, -3.000000 },  //  8
    { 16.000000,-19.000000 },  //  9
    {  0.000000,-26.000000 },  // 10

    // glyph '~'
    {  0.000000, 31.000000 },  //  0 bounding box min
    { 38.000000, 53.000000 },  //  1 bounding box max
    {  0.000000, 41.000000 },  //  2
    {  4.000000, 64.000000 },  //  3
    { 19.000000, 42.000000 },  //  4
    { 34.000000, 20.000000 },  //  5
    { 38.000000, 43.000000 },  //  6

    // glyph '\x7f' (triangle symbol for unimplemented chars)
    {  0.000000,  0.000000 },  // 0 bounding box min
    { 44.000000, 60.000000 },  // 1 bounding box max
    {  0.000000,  0.000000 },  // 2
    {  0.000000, 22.000000 },  // 3
    { 22.000000, 42.000000 },  // 4
    { 44.000000, 22.000000 },  // 5
    { 44.000000,  0.000000 },  // 6
};

//---------------------------------------------------------------------
//
// Each string in the displaylist array element is a display list for
// a glyph. The first byte in each string is the character code for
// the glyph. The second byte is the number of xytbl array elements
// used to construct the glyph. The remaining bytes are interpreted by
// the DrawGlyph function to draw the glyph on the display.
//
//---------------------------------------------------------------------

char *displaylist[] = {

// glyph ' '  (blank space)

    " "  "\x2"         // 2 points for this glyph
    ,                  // end of display list for this glyph

// glyph '!'

    "!"  "\x5"         // 5 points for this glyph
    DRAWADOT "\x2"
    MOVE "\x3"
    LINE "\x4"
    ,                  // end of display list for this glyph

// glyph '\"'

    "\""  "\x6"        // 6 points for this glyph
    MOVE "\x2"
    LINE "\x3"
    MOVE "\x4"
    LINE "\x5"
    ,                  // end of display list for this glyph

// glyph '#'

    "#"  "\xa"         // 10 points for this glyph
    MOVE "\x2"
    LINE "\x3"
    MOVE "\x4"
    LINE "\x5"
    MOVE "\x6"
    LINE "\x7"
    MOVE "\x8"
    LINE "\x9"
    ,                  // end of display list for this glyph

// glyph '$'

    "$"  "\x11"         // 17 points for this glyph
    MOVE "\x2" 
    POLYELLIPTICSPLINE "\xc\x3"
    MOVE "\xf"
    LINE "\x10"
    ,                  // end of display list for this glyph        

// glyph '%'

    "%"  "\xa"         // 10 points for this glyph
    MOVE "\x2"
    LINE "\x3" 
    ELLIPSE "\x4\x5\x6" 
    ELLIPSE "\x7\x8\x9"
    ,                  // end of display list for this glyph        

// glyph '&'

    "&"  "\x13"         // 19 points for this glyph
    MOVE "\x2" 
    POLYELLIPTICSPLINE "\x10\x3"
    ,                  // end of display list for this glyph

// glyph '\''

    "\'"  "\x4"         // 4 points for this glyph
    MOVE "\x2"
    LINE "\x3"
    ,                  // end of display list for this glyph

// glyph '('

    "("  "\x7"         // 7 points for this glyph
    MOVE "\x2"
    POLYELLIPTICSPLINE "\x4\x3"
    ,                  // end of display list for this glyph

// glyph ')'

    ")"  "\x7"         // 7 points for this glyph
    MOVE "\x2"
    POLYELLIPTICSPLINE "\x4\x3"
    ,                  // end of display list for this glyph

// glyph '*'

    "*"  "\x8"         // 8 points for this glyph
    MOVE "\x2"
    LINE "\x3"
    MOVE "\x4"
    LINE "\x5"
    MOVE "\x6"
    LINE "\x7"
    ,                  // end of display list for this glyph

// glyph '+'

    "+"  "\x6"         // 6 points for this glyph
    MOVE "\x2"
    LINE "\x3"
    MOVE "\x4"
    LINE "\x5"
    ,                  // end of display list for this glyph

// glyph ','

    ","  "\x6"         // 6 points for this glyph
    MOVE "\x2"
    LINE "\x3"
    POLYELLIPTICSPLINE "\x2\x4"
    ,                  // end of display list for this glyph

// glyph '-'

    "-"  "\x4"         // 4 points for this glyph
    MOVE "\x2"
    LINE "\x3"
    ,                  // end of display list for this glyph

// glyph '.'

    "."  "\x3"         // 3 points for this glyph
    DRAWADOT "\x2"
    ,                  // end of display list for this glyph

// glyph '/'

    "/"  "\x4"         // 4 points for this glyph
    MOVE "\x2"
    LINE "\x3"
    ,                  // end of display list for this glyph

// glyph '0'

    "0"  "\x5"         // 5 points for this glyph
    ELLIPSE "\x2\x3\x4"
    ,                  // end of display list for this glyph

// glyph '1'

    "1"  "\x5"         // 5 points for this glyph
    MOVE "\x2"
    POLYLINE "\x2\x3"
    ,                  // end of display list for this glyph

// glyph '2'

    "2"  "\xc"         // 12 points for this glyph
    MOVE "\x2"
    POLYELLIPTICSPLINE "\x8\x3"
    LINE "\xb"
    ,                  // end of display list for this glyph

// glyph '3'

    "3"  "\x11"         // 17 points for this glyph
    MOVE "\x2"
    POLYELLIPTICSPLINE "\xe\x3"
    ,                  // end of display list for this glyph

// glyph '4'

    "4"  "\x6"         // 6 points for this glyph
    MOVE "\x2"
    POLYLINE "\x3\x3"
    ,                  // end of display list for this glyph

// glyph '5'

    "5"  "\xd"         // 13 points for this glyph
    MOVE "\x2"
    POLYLINE "\x2\x3"
    POLYELLIPTICSPLINE "\x8\x5"
    ,                  // end of display list for this glyph

// glyph '6'

    "6"  "\x11"         // 17 points for this glyph
    MOVE "\x2"
    POLYELLIPTICSPLINE "\xe\x3"
    ,                  // end of display list for this glyph

// glyph '7'

    "7"  "\x6"         // 6 points for this glyph
    MOVE "\x2"
    LINE "\x3"
    POLYELLIPTICSPLINE "\x2\x4"
    ,                  // end of display list for this glyph

// glyph '8'

    "8"  "\x13"         // 19 points for this glyph
    MOVE "\x2"
    POLYELLIPTICSPLINE "\x10\x3"
    CLOSEFIGURE
    ,                  // end of display list for this glyph

// glyph '9'

    "9"  "\x11"         // 17 points for this glyph
    MOVE "\x2"
    POLYELLIPTICSPLINE "\xe\x3"
    ,                  // end of display list for this glyph

// glyph ':'

    ":"  "\x4"         // 4 points for this glyph
    DRAWADOT "\x2"
    DRAWADOT "\x3"
    ,                  // end of display list for this glyph

// glyph ';'

    ";"  "\x7"         // 7 points for this glyph
    MOVE "\x2"
    LINE "\x3"
    POLYELLIPTICSPLINE "\x2\x4"
    DRAWADOT "\x6"
    ,                  // end of display list for this glyph

// glyph '<'

    "<"  "\x5"         // 5 points for this glyph
    MOVE "\x2"
    POLYLINE "\x2\x3"
    ,                  // end of display list for this glyph

// glyph '='

    "="  "\x6"         // 6 points for this glyph
    MOVE "\x2"
    LINE "\x3"
    MOVE "\x4"
    LINE "\x5"
    ,                  // end of display list for this glyph

// glyph '>'

    ">"  "\x5"         // 5 points for this glyph
    MOVE "\x2"
    POLYLINE "\x2\x3"
    ,                  // end of display list for this glyph

// glyph '?'

    "?"  "\x10"         // 16 points for this glyph
    MOVE "\x2"
    POLYELLIPTICSPLINE "\xc\x3"
    DRAWADOT "\xf"
    ,                  // end of display list for this glyph

// glyph '@"

    "@"  "\x12"         // 18 points for this glyph
    ELLIPSE "\x2\x3\x4"
    MOVE "\x5"
    POLYELLIPTICSPLINE "\xc\x6"
    ,                  // end of display list for this glyph

// glyph 'A"

    "A"  "\x7"         // 7 points for this glyph
    MOVE "\x2"
    POLYLINE "\x2\x3"
    ENDFIGURE
    MOVE "\x5"
    LINE "\x6"
    ,                  // end of display list for this glyph

// glyph 'B'

    "B"  "\xf"         // 15 points for this glyph
    MOVE "\x2"
    LINE "\x3" 
    POLYELLIPTICSPLINE "\x4\x4" 
    POLYLINE "\x2\x8" 
    POLYELLIPTICSPLINE "\x4\xa" 
    LINE "\xe" 
    CLOSEFIGURE         
    ,                  // end of display list for this glyph        

// glyph 'C'

    "C"  "\x5"         // 5 points for this glyph 
    ELLIPTICARC "\x2\x3\x4\xf0\x60" 
    ,                  // end of display list for this glyph

// glyph 'D'

    "D"  "\x9"         // 9 points for this glyph
    MOVE "\x2"
    LINE "\x3" 
    POLYELLIPTICSPLINE "\x4\x4" 
    LINE "\x8" 
    CLOSEFIGURE         
    ,                  // end of display list for this glyph

// glyph 'E'

    "E"  "\x8"         // 8 points for this glyph
    MOVE "\x2"
    POLYLINE "\x3\x3"
    MOVE "\x6" 
    LINE "\x7"
    ,                  // end of display list for this glyph

// glyph 'F'

    "F"  "\x7"         // 7 points for this glyph
    MOVE "\x2"
    POLYLINE "\x2\x3"
    MOVE "\x5" 
    LINE "\x6"
    ,                  // end of display list for this glyph        

// glyph 'G'

    "G"  "\x8"         // 8 points for this glyph
    ELLIPTICARC "\x2\x3\x4\xf0\x60"
    MOVE "\x5"
    POLYLINE "\x2\6"
    ,                  // end of display list for this glyph

// glyph 'H'

    "H"  "\x8"         // 8 points for this glyph
    MOVE "\x2" 
    LINE "\x3"
    MOVE "\x4" 
    LINE "\x5"
    MOVE "\x6" 
    LINE "\x7"
    ,                  // end of display list for this glyph

// glyph 'I'

    "I"  "\x4"         // 4 points for this glyph
    MOVE "\x2" 
    LINE "\x3" 
    ,                  // end of display list for this glyph        

// glyph 'J'

    "J"  "\x8"         // 8 points for this glyph
    MOVE "\x2" 
    POLYELLIPTICSPLINE "\x4\x3"
    LINE "\x7" 
    ,                  // end of display list for this glyph        

// glyph 'K'

    "K"  "\x9"         // 9 points for this glyph
    MOVE "\x2"
    POLYELLIPTICSPLINE "\x4\x3"
    MOVE "\x7"
    LINE "\x8" 
    ,                  // end of display list for this glyph        

// glyph 'L'

    "L"  "\x5"         // 5 points for this glyph
    MOVE "\x2"
    POLYLINE "\x2\x3" 
    ,                  // end of display list for this glyph        

// glyph 'M'

    "M"  "\x7"         // 7 points for this glyph
    MOVE "\x2"
    POLYLINE "\x4\x3" 
    ,                  // end of display list for this glyph

// glyph 'N'

    "N"  "\x6"         // 6 points for this glyph
    MOVE "\x2"
    POLYLINE "\x3\x3"
    ,                  // end of display list for this glyph        

// glyph 'O'

    "O"  "\x5"         // 5 points for this glyph 
    ELLIPSE "\x2\x3\x4" 
    ,                  // end of display list for this glyph        

// glyph 'P'

    "P"  "\xa"         // 10 points for this glyph
    MOVE "\x2"
    POLYLINE "\x2\x3"
    POLYELLIPTICSPLINE "\x4\x5"
    LINE "\x9"
    ,                  // end of display list for this glyph        

// glyph 'Q'

    "Q"  "\x8"         // 8 points for this glyph 
    ELLIPSE "\x2\x3\x4"
    MOVE "\x5"
    POLYELLIPTICSPLINE "\x2\x6"
    ,                  // end of display list for this glyph        

// glyph 'R'

    "R"  "\xd"         // 13 points for this glyph
    MOVE "\x2"
    POLYLINE "\x2\x3"
    POLYELLIPTICSPLINE "\x4\x5"
    LINE "\x9"
    MOVE "\xa"
    POLYELLIPTICSPLINE "\x2\xb"
    ,                  // end of display list for this glyph        

// glyph 'S'

    "S"  "\xf"         // 15 points for this glyph
    MOVE "\x2" 
    POLYELLIPTICSPLINE "\xc\x3" 
    ,                  // end of display list for this glyph        

// glyph 'T'

    "T"  "\x6"         // 6 points for this glyph
    MOVE "\x2"
    LINE "\x3"
    MOVE "\x4"
    LINE "\x5" 
    ,                  // end of display list for this glyph        

// glyph 'U'

    "U"  "\x9"         // 9 points for this glyph
    MOVE "\x2"
    LINE "\x3" 
    POLYELLIPTICSPLINE "\x4\x4"
    LINE "\x8" 
    ,                  // end of display list for this glyph        

// glyph 'V'

    "V"  "\x5"         // 5 points for this glyph
    MOVE "\x2"
    POLYLINE "\x2\x3"
    ,                  // end of display list for this glyph        

// glyph 'W'

    "W"  "\x7"         // 7 points for this glyph
    MOVE "\x2"
    POLYLINE "\x4\x3"
    ,                  // end of display list for this glyph        

// glyph 'X'

    "X"  "\x6"         // 6 points for this glyph
    MOVE "\x2"
    LINE "\x3"
    MOVE "\x4"
    LINE "\x5"
    ,                  // end of display list for this glyph        

// glyph 'Y'

    "Y"  "\x7"         // 7 points for this glyph
    MOVE "\x2"
    POLYLINE "\x2\x3"
    MOVE "\x5"
    LINE "\x6"
    ,                  // end of display list for this glyph        

// glyph 'Z'

    "Z"  "\x6"         // 6 points for this glyph
    MOVE "\x2"
    POLYLINE "\x3\x3"
    ,                  // end of display list for this glyph        

// glyph '['

    "["  "\x6"         // 6 points for this glyph
    MOVE "\x2"
    POLYLINE "\x3\x3" 
    ,                  // end of display list for this glyph        

// glyph '\\'

    "\\"  "\x4"         // 4 points for this glyph
    MOVE "\x2"
    LINE "\x3"
    ,                  // end of display list for this glyph        

// glyph ']'

    "]"  "\x6"         // 6 points for this glyph
    MOVE "\x2"
    POLYLINE "\x3\x3" 
    ,                  // end of display list for this glyph        

// glyph '^'

    "^"  "\x5"         // 5 points for this glyph
    MOVE "\x2"
    POLYLINE "\x2\x3" 
    ,                  // end of display list for this glyph        

// glyph '_'

    "_"  "\x4"         // 4 points for this glyph
    MOVE "\x2"
    LINE "\x3" 
    ,                  // end of display list for this glyph        

// glyph '`'

    "`"  "\x4"         // 4 points for this glyph
    MOVE "\x2"
    LINE "\x3" 
    ,                  // end of display list for this glyph        

// glyph 'a'

    "a"  "\x7"         // 7 points for this glyph 
    ELLIPSE "\x2\x3\x4"
    MOVE "\x5"
    LINE "\x6" 
    ,                  // end of display list for this glyph        

// glyph 'b'

    "b"  "\x7"         // 7 points for this glyph 
    ELLIPSE "\x2\x3\x4"
    MOVE "\x5"
    LINE "\x6" 
    ,                  // end of display list for this glyph        

// glyph 'c'

    "c"  "\x5"         // 5 points for this glyph 
    ELLIPTICARC "\x2\x3\x4\xf0\x60" 
    ,                  // end of display list for this glyph        

// glyph 'd'

    "d"  "\x7"         // 7 points for this glyph 
    ELLIPSE "\x2\x3\x4"
    MOVE "\x5"
    LINE "\x6" 
    ,                  // end of display list for this glyph        

// glyph 'e'

    "e"  "\xc"         // 12 points for this glyph 
    MOVE "\x2"
    LINE "\x3"
    POLYELLIPTICSPLINE "\x8\x4"
    ,                  // end of display list for this glyph        

// glyph 'f'

    "f"  "\xa"         // 10 points for this glyph 
    MOVE "\x2" 
    POLYELLIPTICSPLINE "\x4\x3"
    LINE "\x7" 
    MOVE "\x8"
    LINE "\x9"
    ,                  // end of display list for this glyph        

// glyph 'g'

    "g"  "\xb"         // 11 points for this glyph 
    ELLIPSE "\x2\x3\x4"
    MOVE "\x5"
    LINE "\x6"
    POLYELLIPTICSPLINE "\x4\x7"
    ,                  // end of display list for this glyph

// glyph 'h'

    "h"  "\xa"         // 10 points for this glyph
    MOVE "\x2" 
    LINE "\x3"
    MOVE "\x4"
    POLYELLIPTICSPLINE "\x4\x5" 
    LINE "\x9"
    ,                  // end of display list for this glyph

// glyph 'i'

    "i"  "\x5"         // 5 points for this glyph
    MOVE "\x2" 
    LINE "\x3"
    DRAWADOT "\x4" 
    ,                  // end of display list for this glyph

// glyph 'j'

    "j"  "\x9"         // 9 points for this glyph
    MOVE "\x2" 
    POLYELLIPTICSPLINE "\x4\x3"
    LINE "\x7"
    DRAWADOT "\x8" 
    ,                  // end of display list for this glyph

// glyph 'k'

    "k"  "\x8"         // 8 points for this glyph
    MOVE "\x2" 
    LINE "\x3"
    MOVE "\x4" 
    LINE "\x5"
    MOVE "\x6" 
    LINE "\x7" 
    ,                  // end of display list for this glyph

// glyph 'l'

    "l"  "\x4"         // 4 points for this glyph
    MOVE "\x2" 
    LINE "\x3" 
    ,                  // end of display list for this glyph

// glyph 'm'

    "m"  "\x10"         // 16 points for this glyph
    MOVE "\x2" 
    LINE "\x3"
    MOVE "\x4"
    POLYELLIPTICSPLINE "\x4\x5" 
    LINE "\x9"
    MOVE "\xa"
    POLYELLIPTICSPLINE "\x4\xb" 
    LINE "\xf"
    ,                  // end of display list for this glyph

// glyph 'n'

    "n"  "\xa"         // 10 points for this glyph
    MOVE "\x2" 
    LINE "\x3"
    MOVE "\x4"
    POLYELLIPTICSPLINE "\x4\x5" 
    LINE "\x9"
    ,                  // end of display list for this glyph

// glyph 'o'

    "o"  "\x5"         // 5 points for this glyph 
    ELLIPSE "\x2\x3\x4" 
    ,                  // end of display list for this glyph        

// glyph 'p'

    "p"  "\x7"         // 7 points for this glyph 
    ELLIPSE "\x2\x3\x4"
    MOVE "\x5"
    LINE "\x6" 
    ,                  // end of display list for this glyph        

// glyph 'q'

    "q"  "\x7"         // 7 points for this glyph 
    ELLIPSE "\x2\x3\x4"
    MOVE "\x5"
    LINE "\x6" 
    ,                  // end of display list for this glyph        

// glyph 'r'

    "r"  "\x9"         // 9 points for this glyph
    MOVE "\x2" 
    LINE "\x3"
    MOVE "\x4"
    POLYELLIPTICSPLINE "\x4\x5"
    ,                  // end of display list for this glyph        

// glyph 's'

    "s"  "\xf"         // 15 points for this glyph
    MOVE "\x2" 
    POLYELLIPTICSPLINE "\xc\x3" 
    ,                  // end of display list for this glyph        

// glyph 't'

    "t"  "\xc"         // 12 points for this glyph 
    MOVE "\x2"
    LINE "\x3"
    POLYELLIPTICSPLINE "\x6\x4" 
    MOVE "\xa"
    LINE "\xb"
    ,                  // end of display list for this glyph

// glyph 'u'

    "u"  "\xa"         // 10 points for this glyph
    MOVE "\x2" 
    LINE "\x3"
    MOVE "\x4"
    POLYELLIPTICSPLINE "\x4\x5" 
    LINE "\x9"
    ,                  // end of display list for this glyph

// glyph 'v'

    "v"  "\x5"         // 5 points for this glyph
    MOVE "\x2"
    POLYLINE "\x2\x3"
    ,                  // end of display list for this glyph        

// glyph 'w'

    "w"  "\x7"         // 7 points for this glyph
    MOVE "\x2"
    POLYLINE "\x4\x3"
    ,                  // end of display list for this glyph        

// glyph 'x'

    "x"  "\x6"         // 6 points for this glyph
    MOVE "\x2"
    LINE "\x3"
    MOVE "\x4"
    LINE "\x5"
    ,                  // end of display list for this glyph        

// glyph 'y'

    "y"  "\x6"         // 6 points for this glyph
    MOVE "\x2"
    LINE "\x3"
    LINE "\x4"
    MOVE "\x3"
    LINE "\x5"
    ,                  // end of display list for this glyph        

// glyph 'z'

    "z"  "\x6"         // 6 points for this glyph
    MOVE "\x2"
    POLYLINE "\x3\x3"
    ,                  // end of display list for this glyph        

// glyph '{'

    "{"  "\xb"         // 11 points for this glyph
    MOVE "\x2" 
    POLYELLIPTICSPLINE "\x8\x3"
    ,                  // end of display list for this glyph

// glyph '|'

    "|"  "\x4"         // 4 points for this glyph
    MOVE "\x2" 
    LINE "\x3" 
    ,                  // end of display list for this glyph        

// glyph '}'

    "}"  "\xb"         // 11 points for this glyph
    MOVE "\x2" 
    POLYELLIPTICSPLINE "\x8\x3"
    ,                  // end of display list for this glyph        

// glyph '~'

    "~"  "\x7"         // 7 points for this glyph
    MOVE "\x2" 
    POLYELLIPTICSPLINE "\x4\x3"
    ,                  // end of display list for this glyph

// glyph '\x7f' ("house" symbol for unimplemented chars)

    "\x7f"  "\x7"        // 7 points for this glyph
    MOVE "\x2"
    POLYLINE "\x4\x3"
    CLOSEFIGURE
    ,                  // end of display list for this glyph

};

//----------------------------------------------------------------------
//
// Initializes font data structures
//
//----------------------------------------------------------------------

TextApp::TextApp() : _width(0), _xspace(1.0)
{
    int offset = 0;
    int oldcc = 0;

    memset(_glyphtbl, 0, sizeof(_glyphtbl));
    _glyph = new GLYPH[ARRAY_LEN(displaylist)];
    assert(_glyph != 0);
    for (int i = 0; i < ARRAY_LEN(displaylist); ++i)
    {
        GLYPH *p = &_glyph[i];
        char *s = displaylist[i];
        int cc = s[0];

        assert(oldcc < cc);
        p->charcode = cc;
        p->xyindex = offset;
        p->xylen = s[1];
        offset += p->xylen;
        p->displist = &s[2];
        p->xy = 0;
        _glyphtbl[cc] = p;
        oldcc = cc;
    }
    assert(offset == ARRAY_LEN(xytbl));
}

TextApp::~TextApp()
{
    for (int i = 0; i < ARRAY_LEN(displaylist); ++i)
    {
        if (_glyph[i].xy != 0)
        {
            delete[] _glyph[i].xy;
        }
    }
    delete[] _glyph;
}

//----------------------------------------------------------------------
//
// Private function: Display list interpreter (draws a glyph)
//
//----------------------------------------------------------------------

void TextApp::DrawGlyph(ShapeGen *sg, char *displist, SGPoint xy[])
{
    signed char *p = reinterpret_cast<signed char*>(displist);

    sg->BeginPath();
    while (p[0] != 0)
    {
        switch (p[0])
        {
        case _MOVE_:
            sg->Move(xy[p[1]].x, xy[p[1]].y);
            p += 2;
            break;             
        case _LINE_:
            sg->Line(xy[p[1]].x, xy[p[1]].y);
            p += 2;
            break;
        case _CLOSEFIGURE_:
            sg->CloseFigure();
            p += 1;
            break;
        case _ENDFIGURE_:
            sg->EndFigure();
            p += 1;
            break;
        case _POLYLINE_:
            sg->PolyLine(p[1], &xy[p[2]]);
            p += 3;
            break;
        case _ELLIPSE_:
            sg->Ellipse(xy[p[1]], xy[p[2]], xy[p[3]]);
            p += 4;
            break;
        case _ELLIPTICARC_:
            sg->EllipticArc(xy[p[1]], xy[p[2]], xy[p[3]],
                            p[4]*(2.0*PI/128.0), p[5]*(2.0*PI/128.0));
            p += 6;
            break;
        case _POLYELLIPTICSPLINE_:
            sg->PolyEllipticSpline(p[1], &xy[p[2]]);
            p += 3;
            break;
        case _DRAWADOT_:
            {
                SGPoint v0, v1, v2;
                SGCoord radius = 65536.0*(0.125*_width + 0.5);
    
                v0 = v1 = v2 = xy[p[1]];
                v1.x += radius;
                v2.y += radius;
                sg->Ellipse(v0, v1, v2);
            }
            p += 2;
            break;
        default:
            assert(0);
            break;
        }
    }
    sg->StrokePath();
}

//----------------------------------------------------------------------
//
// Public function: Draws the glyphs for the specified text string.
// Parameter sg is a pointer to a ShapeGen object. Parameter xfrm is the
// 2x3 transform matrix to apply to the glyphs before they are
// displayed. Parameter str is a string containing the characters that
// are to be displayed. Elements xfrm[0][2] and xfrm[1][2] specify the
// x and y coordinates at which to start drawing the string on the
// display; the starting point is located at the intersection of the
// left edge of the displayed string with the baseline. The other four
// xfrm elements specify the affine transform (scaling, rotation,
// etc.) to apply to the glyphs. Parameter str is the character string
// to display. Parameter xspace specifies how much to expand or shrink
// the default spacing between charaters. An xspace value greater than
// one expands the spacing, and a value less than one shrinks it.
//
//----------------------------------------------------------------------

void TextApp::DisplayText(ShapeGen *sg, const float xfrm[][3], const char *str)
{
    const int MAXLEN = 256;
    int nbits = sg->SetFixedBits(16);
    LINEEND saveLineEnd = sg->SetLineEnd(LINEEND_ROUND);
    LINEJOIN saveLineJoin = sg->SetLineJoin(LINEJOIN_ROUND);
    int len = strnlen(str, MAXLEN);
    float lbear = _xspace*leftbearing;
    float rbear = _xspace*rightbearing;
    float advance;
    XY pos;

    _width = sg->SetLineWidth(0);
    sg->SetLineWidth(_width);
    assert(len < MAXLEN);
    pos.x = xfrm[0][0]*lbear + xfrm[0][2];
    pos.y = xfrm[1][0]*lbear + xfrm[1][2];

    // Each iteration of this for-loop draws one char
    for (int i = 0; i < len; ++i)
    {
        int cc = str[i];
        GLYPH *p = _glyphtbl[cc & 0x7f];

        // If glyph is not implemented, use default symbol
        if (cc > 0x7f || p == 0)
            p = _glyphtbl[0x7f];

        // Point to start of xytbl entries for this glyph
        const XY *pxytbl = &xytbl[p->xyindex];

        // Transform the x-y coordinates for this glyph, and convert
        // them to 16.16 fixed-point format
        if (p->xy == 0 && p->xylen != 0)
        {
            // Allocate buffer for transformed x-y coordinates
            p->xy = new SGPoint[p->xylen];
            assert(p->xy != 0);
        }
        for (int j = 2; j < p->xylen; ++j)
        {
            float xtbl = pxytbl[j].x;
            float ytbl = pxytbl[j].y;

            p->xy[j].x = 65536.0*(xfrm[0][0]*xtbl - xfrm[0][1]*ytbl + (double)pos.x);
            p->xy[j].y = 65536.0*(xfrm[1][0]*xtbl - xfrm[1][1]*ytbl + (double)pos.y);
        }

        // Interpret display list for this glyph
        DrawGlyph(sg, p->displist, p->xy);

        // Advance to x-y position of next glyph
        advance = lbear + (pxytbl[1].x - pxytbl[0].x) + rbear;
        pos.x += xfrm[0][0]*advance;
        pos.y += xfrm[1][0]*advance;
    }
    sg->SetFixedBits(nbits);  // restore caller's original settings
    sg->SetLineEnd(saveLineEnd);
    sg->SetLineJoin(saveLineJoin);
}

//----------------------------------------------------------------------
//
// Public function: Draws the glyphs for the specified text string.
// This version of the function draws only horizontal text, but
// supports translation (to starting point xystart) and scaling (by the
// scale parameter value).
//
//----------------------------------------------------------------------

void TextApp::DisplayText(ShapeGen *sg, SGPoint xystart, float scale, const char *str)
{
    float xfrm[2][3];

    xfrm[0][0] = scale;
    xfrm[0][1] = 0;
    xfrm[0][2] = xystart.x;
    xfrm[1][0] = 0;
    xfrm[1][1] = scale;
    xfrm[1][2] = xystart.y;
    DisplayText(sg, xfrm, str);
}

//---------------------------------------------------------------------
//
// Public function: Calculates the x-y coordinates at the end of a
// text string were the string to be displayed with the specified
// transform and character spacing factor. Note: nothing is actually
// drawn. Parameter xform is the 3x2 transform matrix. Parameter str is
// the text string. Parameter xyout is the output pointer for the end
// point coordinates. The end point lies at the intersection of the
// right edge of the displayed string with the glyph baseline.
// Parameter xspace is the optional character spacing factor, which has
// a default value of 1.0.
//
//---------------------------------------------------------------------

void TextApp::GetTextEndpoint(const float xfrm[][3], const char *str, XY *xyout)
{
    const int MAXLEN = 256;
    int len = strnlen(str, MAXLEN);
    float advance = 0;

    assert(xyout != 0);
    assert(len < MAXLEN);
    
    // Each iteration of this for-loop adds the width of a glyph
    for (int i = 0; i < len; ++i)
    {   
        int cc = str[i];
        GLYPH *p = _glyphtbl[cc & 0x7f];

        // If glyph is not implemented, use default symbol
        if (cc > 0x7f || p == 0)
            p = _glyphtbl[1];

        // Point to the start of the xytbl entries for this glyph
        const XY *pxytbl = &xytbl[p->xyindex];

        // First two entries are bounding box min/max coordinates
        advance += pxytbl[1].x - pxytbl[0].x;
    }

    // Advance to x-y position at end of last glyph
    advance += _xspace*len*(leftbearing + rightbearing);
    xyout->x = xfrm[0][0]*advance + xfrm[0][2];
    xyout->y = xfrm[1][0]*advance + xfrm[1][2];
}

//---------------------------------------------------------------------
//
// Returns the width in pixels of a horizontal text string
//
//---------------------------------------------------------------------

float TextApp::GetTextWidth(float scale, const char *str)
{
    XY xyout;
    float xfrm[2][3];
    SGPoint xystart = { 0, 0 };

    xfrm[0][0] = scale;
    xfrm[0][1] = 0;
    xfrm[0][2] = xystart.x;
    xfrm[1][0] = 0;
    xfrm[1][1] = scale;
    xfrm[1][2] = xystart.y;
    GetTextEndpoint(xfrm, str, &xyout);
    return xyout.x;
}

//---------------------------------------------------------------------
//
// Set the text spacing factor. Parameter xspace is the character-
// spacing multiplier. To expand the spacing between characters, 
// specify an xspace value greater than one. For example, an xspace
// value of 1.2 specifies a 20 percent increase over the default
// spacing. To decrease the spacing between characters, specify an
// xspace value less than one. An xspace value of one restores the
// default character spacing.
//
//---------------------------------------------------------------------

void TextApp::SetTextSpacing(float xspace)
{
    _xspace = xspace;
}
